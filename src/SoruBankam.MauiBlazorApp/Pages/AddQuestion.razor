@page "/add-question"
@inject IQuestionManager questionManager;
@inject ISnackbar snackbar;

<MudPaper>
    <MudContainer>
        <MudPaper>
            <MudGrid>
                <MudItem xs="12" md="6" lg="6">
                    <MudItem xs="12">
                        <MudImage style="max-height: 230px; max-width: 300px;" Src="@base64ImageQuestion" />
                    </MudItem>
                    <MudItem xs="12">
                        <MudButton OnClick="TakePhotoQuestion">Soru Ekle</MudButton>
                    </MudItem>
                </MudItem>
                <MudItem xs="12" md="6" lg="6">
                    <MudItem xs="12">
                        <MudImage style="max-height: 230px; max-width: 300px" Src="@base64ImageAnswer" />
                    </MudItem>
                    <MudItem xs="12">
                        <MudButton OnClick="TakePhotoAnswer">Cevap Ekle</MudButton>
                    </MudItem>
                </MudItem>
                
                
                <MudItem xs="12">
                    <MudTextField T="string" Label="Açıklama" Variant="Variant.Outlined" @bind-Text="@description" Lines="3" />
                </MudItem>
                <MudItem xs="12">
                    <MudButton OnClick="Save" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Color="Color.Info" Size="Size.Medium">Kaydet</MudButton>
                </MudItem>
            </MudGrid>
        </MudPaper>
    </MudContainer>
</MudPaper>


@code {
    String base64ImageQuestion = "";
    String base64ImageAnswer = "";
    String description = "";
    bool saved = false;
    string errors = "";

    private async Task TakePhotoQuestion()
    {
        base64ImageQuestion = await BrowserFileTool.TakePhotoAndConvertBase64();
        await InvokeAsync(() => StateHasChanged());
    }
    private async Task TakePhotoAnswer()
    {
        base64ImageAnswer = await BrowserFileTool.TakePhotoAndConvertBase64();
        await InvokeAsync(() => StateHasChanged());
    }

    private async Task Save()
    {
        try
        {
            saved = false;


            var question = new Question();
            question.Description = description;
            question.Photo = Base64Tool.ToByteArray(base64ImageQuestion);
            question.AnswerPhoto = Base64Tool.ToByteArray(base64ImageAnswer);

            if (description == "" || base64ImageQuestion == "" || base64ImageAnswer == "")
            {
                //burada herhangi bilgininbiri girilmediyse uyarı verecek
                snackbar.Add("lütfen girdileri kontrol ediniz", Severity.Warning);
                return;
            }

            questionManager.Add(question);
            saved = true;
            base64ImageQuestion = "";
            base64ImageAnswer = "";
            description = "";

            await InvokeAsync(() => StateHasChanged());

            snackbar.Add("Soru eklendi.", Severity.Success);

            await Task.CompletedTask;
        }
        catch (Exception ex)
        {
            snackbar.Add(ex.Message, Severity.Error);
        }
    }
}
